<!doctype html>






<html class="theme-next pisces use-motion" lang="zh-Hans">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />

















  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







  <link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

  <link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Keras translation," />





  <link rel="alternate" href="/atom.xml" title="春暖花开" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.0" />






  <meta name="description" content="Introduction
In my previous article, I discussed the implementation of neural networks using TensorFlow. Continuing the series of articles
  on neural network libraries, I have decided to throw light">
  <meta property="og:type" content="article">
  <meta property="og:title" content="以图像识别为例 - 使用 Keras 来优化神经网络">
  <meta property="og:url" content="http://ucasfl.me/2017/11/12/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/index.html">
  <meta property="og:site_name" content="春暖花开">
  <meta property="og:description" content="Introduction
In my previous article, I discussed the implementation of neural networks using TensorFlow. Continuing the series of articles
  on neural network libraries, I have decided to throw light">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/DEEP-LEARNING-1.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/keras-logo-small.jpg">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/3.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/one-1024x353.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/training_keras-1024x211.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme3.jpg">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/trained_500-1024x210.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d-1024x215.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d_with_drop-1024x211.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_drop_with_more_epoch-1024x349.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme2.jpg">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_model_deep_n_wide-1024x309.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_cnn-1024x208.png">
  <meta property="og:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/season-xfer-1024x234.jpg">
  <meta property="og:updated_time" content="2017-11-12T16:29:22.965Z">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="以图像识别为例 - 使用 Keras 来优化神经网络">
  <meta name="twitter:description" content="Introduction
In my previous article, I discussed the implementation of neural networks using TensorFlow. Continuing the series of articles
  on neural network libraries, I have decided to throw light">
  <meta name="twitter:image" content="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/DEEP-LEARNING-1.png">



  <script type="text/javascript" id="hexo.configurations">
    var NexT = window.NexT || {};
    var CONFIG = {
      root: '/',
      scheme: 'Pisces',
      sidebar: {
        "position": "left",
        "display": "post",
        "offset": 12,
        "offset_float": 0,
        "b2t": false,
        "scrollpercent": true
      },
      fancybox: true,
      motion: true,
      duoshuo: {
        userId: 'undefined',
        author: '博主'
      },
      algolia: {
        applicationID: '',
        apiKey: '',
        indexName: '',
        hits: {
          "per_page": 10
        },
        labels: {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      }
    };
  </script>



  <link rel="canonical" href="http://ucasfl.me/2017/11/12/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/" />





  <title> 以图像识别为例 - 使用 Keras 来优化神经网络 | 春暖花开 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">





















  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-wrapper">
          <div class="site-meta ">


            <div class="custom-logo-site-title">
              <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">春暖花开</span>
        <span class="logo-line-after"><i></i></span>
      </a>
            </div>

            <p class="site-subtitle">love, life, thinking, coding</p>

          </div>

          <div class="site-nav-toggle">
            <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
          </div>
        </div>

        <nav class="site-nav">



          <ul id="menu" class="menu">


            <li class="menu-item menu-item-home">
              <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
            </li>


            <li class="menu-item menu-item-categories">
              <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
            </li>


            <li class="menu-item menu-item-about">
              <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
            </li>


            <li class="menu-item menu-item-archives">
              <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
            </li>


            <li class="menu-item menu-item-tags">
              <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
            </li>



            <li class="menu-item menu-item-search">

              <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
            </li>

          </ul>



          <div class="site-search">

            <div class="popup local-search-popup">
              <div class="local-search-header clearfix">
                <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
                <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
                <div class="local-search-input-wrapper">
                  <input autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
                </div>
              </div>
              <div id="local-search-result"></div>
            </div>



          </div>

        </nav>



      </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">


            <div id="posts" class="posts-expand">








              <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
                <link itemprop="mainEntityOfPage" href="http://ucasfl.me/2017/11/12/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/">

                <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Flynn">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/photos/profile.jpeg">
  </span>

                <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="春暖花开">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="春暖花开" src="">
    </span>
                </span>


                <header class="post-header">



                  <h1 class="post-title" itemprop="name headline">



                    以图像识别为例 - 使用 Keras 来优化神经网络


                  </h1>


                  <div class="post-meta">
                    <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>

                    <span class="post-meta-item-text">发表于</span>

                    <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-12T12:10:14+08:00">
                2017/11/12
              </time>





                    </span>


                    <span class="post-category">
            
              <span class="post-meta-divider">|</span>

                    <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>

                    <span class="post-meta-item-text">分类于</span>


                    <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Machine-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Machine-Learning</span>
                    </a>
                    </span>




                    </span>








                    <span id="/2017/11/12/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/" class="leancloud_visitors" data-flag-title="以图像识别为例 - 使用 Keras 来优化神经网络">
               <span class="post-meta-divider">|</span>
                    <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>

                    <span class="post-meta-item-text">阅读次数 </span>

                    <span class="leancloud-visitors-count"></span>
                    </span>








                  </div>
                </header>



                <div class="post-body" itemprop="articleBody">





                  <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2>
                  <p>In my <a href="https://www.analyticsvidhya.com/blog/2016/10/an-introduction-to-implementing-neural-networks-using-tensorflow/" target="_blank" rel="external">previous article</a>, I discussed the implementation of neural networks using
                    TensorFlow. Continuing the series of articles on neural network libraries, I have decided to throw light on Keras – supposedly the best deep learning library so far.</p>
                  <a id="more"></a>
                  <p>I have been working on deep learning for sometime now and according to me, the most difficult thing when dealing with Neural Networks is the never-ending range of parameters to tune. With increase in depth of a Neural Network, it becomes
                    increasingly difficult to take care of all the parameters. Mostly, people rely on intuition and experience to tune it. In reality, research is still rampant on this topic.</p>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/DEEP-LEARNING-1.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/DEEP-LEARNING-1.png" alt="deep-learning-1"></a></p>
                  <p>Thankfully we have Keras, which takes care of a lot of this hard work and provides an easier interface!</p>
                  <p>In this article, I am going to share my experience of working in deep learning. We will begin with an overview of Keras, its features and differentiation over other libraries. We will then, look at a simple implementation of neural networks
                    in Keras. And then, I will take you through a hands-on exercise on parameter tuning in neural networks.</p>
                  <h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2>
                  <ol>
                    <li>
                      <ol>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#one" target="_blank" rel="external">Keras : Overview</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#two" target="_blank" rel="external">Keras: Advantages</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#three" target="_blank" rel="external">Keras: Limitations</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#four" target="_blank" rel="external">General way to solve problems with Neural Networks</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#five" target="_blank" rel="external">Starting with a simple Keras implementation on “Identify the Digits”</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#six" target="_blank" rel="external">Hyperparameters to look out for in Neural Networks</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#seven" target="_blank" rel="external">Getting your hands dirty (Parameter Tuning)</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#eight" target="_blank" rel="external">Where to go from here?</a></li>
                        <li><a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/#nine" target="_blank" rel="external">Additional Resources</a></li>
                      </ol>
                    </li>
                  </ol>
                  <h2 id="1-Keras-Overview"><a href="#1-Keras-Overview" class="headerlink" title="1. Keras : Overview"></a>1. Keras : Overview</h2>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/keras-logo-small.jpg" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/keras-logo-small.jpg" alt="keras-logo-small"></a></p>
                  <p>Keras is a high level library, used specially for building neural network models. It is written in Python and is compatible with both Python – 2.7 &amp; 3.5. Keras was specifically developed for fast execution of ideas. It has a simple
                    and highly modular interface, which makes it easier to create even complex neural network models. This library abstracts low level libraries, namely Theano and TensorFlow so that, the user is free from “implementation details” of these
                    libraries.</p>
                  <p>The key features of Keras are:</p>
                  <ul>
                    <li><strong>Modularity :</strong> Modules necessary for building a neural network are included in a simple interface so that Keras is easier to use for the end user.</li>
                    <li><strong>Minimalistic :</strong> Implementation is short and concise.</li>
                    <li><strong>Extensibility :</strong> It’s very easy to write a new module for Keras and makes it suitable for advance research.</li>
                  </ul>
                  <h2 id="2-Keras-Advantages"><a href="#2-Keras-Advantages" class="headerlink" title="2. Keras : Advantages"></a>2. Keras : Advantages</h2>
                  <p>Being a high level library and its simpler interface, Keras certainly shines as one of the best deep learning library available. Few features of Keras, which stands out in comparison with other libraries are:</p>
                  <ul>
                    <li>In comparison to Theano and TensorFlow, it takes in all the advantages of both of these libraries and tries to give a better “user experience”.</li>
                    <li>As Keras is a python library, it is more accessible to general public because of Python’s inherent simplicity as a programming language.</li>
                    <li>A similar library in comparison to Keras is Lasagne, but having used both I can say that Keras is much easier to use.</li>
                  </ul>
                  <p>Given the above reasons, it is no surprise that Keras is increasingly becoming popular as a deep learning library.</p>
                  <h2 id="3-Keras-Limitations"><a href="#3-Keras-Limitations" class="headerlink" title="3. Keras : Limitations"></a>3. Keras : Limitations</h2>
                  <ul>
                    <li>I think that having a dependency on low level libraries like Theano / TensorFlow is a double edged sword. This is because Keras cannot go “out of the realms” of these libraries. For example, both Theano and TensorFlow do not support
                      GPUs other than Nvidia (currently). And hence, Keras too doesn’t have the corresponding support.</li>
                    <li>Also unlike Lasagne, Keras completely abstracts the low level languages. So, it is less flexible when it comes to building custom operations.</li>
                    <li>The last point I’ll make is that Keras is relatively new. The first version was released in early 2015, and it has undergone many changes since then. Although Keras is already used in production, but you should think twice before deploying
                      keras models for productions.</li>
                  </ul>
                  <h2 id="4-General-way-to-solve-problems-with-Neural-Networks"><a href="#4-General-way-to-solve-problems-with-Neural-Networks" class="headerlink" title="4. General way to solve problems with Neural Networks"></a>4. General way to solve problems with Neural Networks</h2>
                  <p>Neural networks is a special type of machine learning (ML) algorithm. So, like every ML algorithm, it follows the usual ML workflow of data preprocessing, model building and model evaluation. For the sake of conciseness, I have listed
                    out a To-D0 list of how to approach a Neural Network problem.</p>
                  <ul>
                    <li>Check if it is a problem where Neural Network gives you uplift over traditional algorithms (refer to the checklist in the section above)</li>
                    <li>Do a survey of which Neural Network architecture is most suitable for the required problem</li>
                    <li>Define Neural Network architecture through whichever language / library you choose.</li>
                    <li>Convert data to right format and divide it in batches</li>
                    <li>Pre-process the data according to your needs</li>
                    <li>Augment Data to increase size and make better trained models</li>
                    <li>Feed batches to Neural Network</li>
                    <li>Train and monitor changes in training and validation data sets</li>
                    <li>Test your model, and save it for future use</li>
                  </ul>
                  <h2 id="5-Starting-with-a-simple-Keras-implementation-on-“Identify-the-Digits”"><a href="#5-Starting-with-a-simple-Keras-implementation-on-“Identify-the-Digits”" class="headerlink" title="5. Starting with a simple Keras implementation on “Identify the Digits”"></a>5. Starting with a simple Keras implementation on
                    “Identify the Digits”</h2>
                  <p>Before starting this experiment, make sure you have Keras installed in your system. Refer the <a href="https://keras.io/#installation" target="_blank" rel="external">official installation guide</a>. We will use tensorflow for backend,
                    so make sure you have this done in your config file. If not, follow the steps given <a href="https://keras.io/backend/" target="_blank" rel="external">here</a>.</p>
                  <p>Here, we solve our deep learning practice problem – <a href="https://datahack.analyticsvidhya.com/contest/practice-problem-identify-the-digits/" target="_blank" rel="external">Identify the Digits</a>. Let’s take a look at our problem
                    statement:</p>
                  <p>Our problem is an image recognition problem, to identify digits from a given 28 x 28 image. We have a subset of images for training and the rest for testing our model. So first, download the train and test files. The dataset contains
                    a zipped file of all the images and both the train.csv and test.csv have the name of corresponding train and test images. Any additional features are not provided in the datasets, just the raw images are provided in ‘.png’ format.</p>
                  <p>Let’s start:</p>
                  <h3 id="STEP-0-Getting-Ready"><a href="#STEP-0-Getting-Ready" class="headerlink" title="STEP 0: Getting Ready"></a>STEP 0: Getting Ready</h3>
                  <p>a) Import all the necessary libraries</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">%pylab inline</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="title">from</span> scipy.misc <span class="keyword">import</span> imread</div><div class="line"><span class="title">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</div><div class="line"></div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">import</span> keras</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>b) Let’s set a seed value, so that we can control our models randomness</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># To stop potential randomness</span></div><div class="line"><span class="attr">seed</span> = <span class="number">128</span></div><div class="line"><span class="attr">rng</span> = np.random.RandomState(seed)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>c) The first step is to set directory paths, for safekeeping!</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">root_dir = <span class="built_in">os</span>.path.abspath(<span class="string">'../..'</span>)</div><div class="line">data_dir = <span class="built_in">os</span>.path.join(root_dir, <span class="string">'data'</span>)</div><div class="line">sub_dir = <span class="built_in">os</span>.path.join(root_dir, <span class="string">'sub'</span>)</div><div class="line"># check <span class="keyword">for</span> existence</div><div class="line"><span class="built_in">os</span>.path.exists(root_dir)</div><div class="line"><span class="built_in">os</span>.path.exists(data_dir)</div><div class="line"><span class="built_in">os</span>.path.exists(sub_dir)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="STEP-1-Data-Loading-and-Preprocessing"><a href="#STEP-1-Data-Loading-and-Preprocessing" class="headerlink" title="STEP 1: Data Loading and Preprocessing"></a>STEP 1: Data Loading and Preprocessing</h3>
                  <p>a) Now let us read our datasets. These are in .csv formats, and have a filename along with the appropriate labels</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">train = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'train.csv'</span>))</div><div class="line">test = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Test.csv'</span>))</div><div class="line"></div><div class="line">sample_submission = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Sample_Submission.csv'</span>))</div><div class="line"></div><div class="line">train.head()</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <table>
                    <thead>
                      <tr>
                        <th></th>
                        <th>filename</th>
                        <th>label</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>0</td>
                        <td>0.png</td>
                        <td>4</td>
                      </tr>
                      <tr>
                        <td>1</td>
                        <td>1.png</td>
                        <td>9</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>2.png</td>
                        <td>1</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>3.png</td>
                        <td>7</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td>4.png</td>
                        <td>3</td>
                      </tr>
                    </tbody>
                  </table>
                  <p>b) Let us see what our data looks like! We read our image and display it.</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">img_name = rng.choice(train.filename)</div><div class="line">filepath = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'train'</span>, img_name)</div><div class="line"></div><div class="line"><span class="selector-tag">img</span> = imread(filepath, flatten=True)</div><div class="line"></div><div class="line">pylab.imshow(<span class="selector-tag">img</span>, cmap=<span class="string">'gray'</span>)</div><div class="line">pylab.axis(<span class="string">'off'</span>)</div><div class="line">pylab.show()</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/3.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/3.png" alt="3"></a></p>
                  <p>c) The above image is represented as numpy array, as seen below</p>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/one.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/one-1024x353.png" alt="one"></a></p>
                  <p>d) For easier data manipulation, let’s store all our images as numpy arrays</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">temp = []</div><div class="line"><span class="keyword">for</span> img_name <span class="keyword">in</span> train<span class="selector-class">.filename</span>:</div><div class="line">    image_path = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'train'</span>, img_name)</div><div class="line">    <span class="selector-tag">img</span> = imread(image_path, flatten=True)</div><div class="line">    <span class="selector-tag">img</span> = <span class="selector-tag">img</span>.astype(<span class="string">'float32'</span>)</div><div class="line">    temp.append(img)</div><div class="line">    </div><div class="line">train_x = np.stack(temp)</div><div class="line"></div><div class="line">train_x /= <span class="number">255.0</span></div><div class="line">train_x = train_x.reshape(-<span class="number">1</span>, <span class="number">784</span>).astype(<span class="string">'float32'</span>)</div><div class="line"></div><div class="line">temp = []</div><div class="line"><span class="keyword">for</span> img_name <span class="keyword">in</span> test<span class="selector-class">.filename</span>:</div><div class="line">    image_path = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'test'</span>, img_name)</div><div class="line">    <span class="selector-tag">img</span> = imread(image_path, flatten=True)</div><div class="line">    <span class="selector-tag">img</span> = <span class="selector-tag">img</span>.astype(<span class="string">'float32'</span>)</div><div class="line">    temp.append(img)</div><div class="line">    </div><div class="line">test_x = np.stack(temp)</div><div class="line"></div><div class="line">test_x /= <span class="number">255.0</span></div><div class="line">test_x = test_x.reshape(-<span class="number">1</span>, <span class="number">784</span>).astype(<span class="string">'float32'</span>)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">train_y = keras<span class="selector-class">.utils</span><span class="selector-class">.np_utils</span><span class="selector-class">.to_categorical</span>(train<span class="selector-class">.label</span><span class="selector-class">.values</span>)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>e) As this is a typical ML problem, to test the proper functioning of our model we create a validation set. Let’s take a split size of 70:30 for train set vs validation set</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">split_size = int(train_x.shape<span class="string">[0]</span>*<span class="number">0</span>.<span class="number">7</span>)</div><div class="line"></div><div class="line">train_x, val_x = train_x<span class="string">[:split_size]</span>, train_x<span class="string">[split_size:]</span></div><div class="line">train_y, val_y = train_y<span class="string">[:split_size]</span>, train_y<span class="string">[split_size:]</span></div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="selector-tag">train</span><span class="selector-class">.label</span><span class="selector-class">.ix</span><span class="selector-attr">[split_size:]</span></div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="STEP-2-Model-Building"><a href="#STEP-2-Model-Building" class="headerlink" title="STEP 2: Model Building"></a>STEP 2: Model Building</h3>
                  <p>a) Now comes the main part! Let us define our neural network architecture. We define a neural network with 3 layers input, hidden and output. The number of neurons in input and output are fixed, as the input is our 28 x 28 image and
                    the output is a 10 x 1 vector representing the class. We take 50 neurons in the hidden layer. Here, we use <a href="https://arxiv.org/abs/1412.6980" target="_blank" rel="external">Adam</a> as our optimization algorithms, which is an
                    efficient variant of Gradient Descent algorithm. There are a number of other optimizers available in keras (refer <a href="https://keras.io/optimizers/" target="_blank" rel="external">here</a>). In case you don’t understand any of
                    these terminologies, check out the <a href="https://www.analyticsvidhya.com/blog/2016/03/introduction-deep-learning-fundamentals-neural-networks/" target="_blank" rel="external">article on fundamentals of neural network</a> to know
                    more in depth of how it works.</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">5</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="comment"># import keras modules</span></div><div class="line"></div><div class="line">from keras.models <span class="built_in">import</span> Sequential</div><div class="line">from keras.layers <span class="built_in">import</span> Dense</div><div class="line"></div><div class="line"><span class="comment"># create model</span></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line">  Dense(<span class="attr">output_dim=hidden_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line">  Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line">])</div><div class="line"></div><div class="line"><span class="comment"># compile the model with necessary attributes</span></div><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>b) It’s time to train our model</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="attr">trained_model</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/training_keras.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/training_keras-1024x211.png" alt="training_keras"></a></p>
                  <h3 id="STEP-3-Model-Evaluation"><a href="#STEP-3-Model-Evaluation" class="headerlink" title="STEP 3: Model Evaluation"></a>STEP 3: Model Evaluation</h3>
                  <p>a) To test our model with our own eyes, let’s visualize its predictions</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">pred = model.predict_classes(test_x)</div><div class="line"></div><div class="line">img_name = rng.choice(test.filename)</div><div class="line">filepath = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'test'</span>, img_name)</div><div class="line"></div><div class="line"><span class="selector-tag">img</span> = imread(filepath, flatten=True)</div><div class="line"></div><div class="line">test_index = int(img_name.split(<span class="string">'.'</span>)[<span class="number">0</span>]) - train<span class="selector-class">.shape</span>[<span class="number">0</span>]</div><div class="line"></div><div class="line">print <span class="string">"Prediction is: "</span>, pred[test_index]</div><div class="line"></div><div class="line">pylab.imshow(<span class="selector-tag">img</span>, cmap=<span class="string">'gray'</span>)</div><div class="line">pylab.axis(<span class="string">'off'</span>)</div><div class="line">pylab.show()</div><div class="line"></div><div class="line">Prediction is:  <span class="number">8</span></div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>b) We see that our model performs well even on being very simple. Now we create a submission with our model</p>
                  <figure class="highlight tcl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">sample_submission.<span class="keyword">filename</span> = test.<span class="keyword">filename</span>; sample_submission.label = pred</div><div class="line">sample_submission.to_csv(os.path.<span class="keyword">join</span>(sub_dir, <span class="string">'sub02.csv'</span>), index=False)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="6-Hyperparameters-to-look-out-for-in-Neural-Networks"><a href="#6-Hyperparameters-to-look-out-for-in-Neural-Networks" class="headerlink" title="6. Hyperparameters to look out for in Neural Networks"></a>6. Hyperparameters to look out for in Neural Networks</h2>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme3.jpg" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme3.jpg" alt="dl_meme3"></a>I feel that, hyperparameter
                    tuning is the hardest in neural network in comparison to any other machine learning algorithm. You would be insane to apply Grid Search, as there are numerous parameters when it comes to tuning a neural network.</p>
                  <p><em>Note: I have discussed a few more details, on when to apply neural networks in the following article An Introduction to Implementing Neural Networks using TensorFlow</em></p>
                  <p>Some important parameters to look out for while optimizing neural networks are:</p>
                  <ul>
                    <li><strong>Type of architecture</strong></li>
                    <li><strong>Number of Layers<em>**</em></strong></li>
                    <li><strong>Number of Neurons in a layer</strong></li>
                    <li><strong>Regularization parameters</strong></li>
                    <li><strong>Learning Rate</strong></li>
                    <li><strong>Type of optimization / backpropagation technique to use</strong></li>
                    <li><strong>Dropout rate</strong></li>
                    <li><strong>Weight sharing</strong></li>
                  </ul>
                  <p>Also, there may be many more hyperparameters depending on the type of architecture. For example, if you use a convolutional neural network, you would have to look at hyperparameters like convolutional filter size, pooling value, etc.</p>
                  <p>The best way to pick good parameters is to understand your problem domain. Research the previously applied techniques on your data, and most importantly ask experienced people for insights to the problem. It’s the only way you can try
                    to ensure you get a “good enough” neural network model.</p>
                  <p>Here are some resources for tips and tricks for training neural networks. (<a href="http://cs231n.github.io/neural-networks-3/#baby" target="_blank" rel="external">Resource 1</a>, <a href="https://www.quora.com/Machine-Learning-What-are-some-tips-and-tricks-for-training-deep-neural-networks"
                      target="_blank" rel="external">Resource 2</a>,
                    <a href="https://arxiv.org/abs/1206.5533" target="_blank" rel="external">Resource 3</a>)</p>
                  <h2 id="7-Getting-your-hands-dirty"><a href="#7-Getting-your-hands-dirty" class="headerlink" title="7. Getting your hands dirty"></a>7. Getting your hands dirty</h2>
                  <p>Let us take our knowledge of hyperparameters and start tweaking our neural network model.</p>
                  <ul>
                    <li>As we did before, we redo all the pre-requisite things. Let’s import the modules</li>
                  </ul>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">%pylab inline</div><div class="line"></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="title">from</span> scipy.misc <span class="keyword">import</span> imread</div><div class="line"><span class="title">from</span> sklearn.metrics <span class="keyword">import</span> accuracy_score</div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">import</span> keras</div><div class="line"></div><div class="line"><span class="title">from</span> keras.models <span class="keyword">import</span> Sequential</div><div class="line"><span class="title">from</span> keras.layers <span class="keyword">import</span> Dense, Activation, Dropout, Convolution2D, Flatten, MaxPooling2D, Reshape, InputLayer</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>As before, set seed value</li>
                  </ul>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># To stop potential randomness</span></div><div class="line"><span class="attr">seed</span> = <span class="number">128</span></div><div class="line"><span class="attr">rng</span> = np.random.RandomState(seed)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Set paths for further use</li>
                  </ul>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">root_dir = <span class="built_in">os</span>.path.abspath(<span class="string">'../..'</span>)</div><div class="line">data_dir = <span class="built_in">os</span>.path.join(root_dir, <span class="string">'data'</span>)</div><div class="line">sub_dir = <span class="built_in">os</span>.path.join(root_dir, <span class="string">'sub'</span>)</div><div class="line"></div><div class="line"># check <span class="keyword">for</span> existence</div><div class="line"><span class="built_in">os</span>.path.exists(root_dir)</div><div class="line"><span class="built_in">os</span>.path.exists(data_dir)</div><div class="line"><span class="built_in">os</span>.path.exists(sub_dir)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Read the datasets and convert them to usable form</li>
                  </ul>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">train = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'train.csv'</span>))</div><div class="line">test = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Test.csv'</span>))</div><div class="line"></div><div class="line">sample_submission = pd.read_csv(os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Sample_Submission.csv'</span>))</div><div class="line"></div><div class="line">temp = []</div><div class="line"><span class="keyword">for</span> img_name <span class="keyword">in</span> train<span class="selector-class">.filename</span>:</div><div class="line">  image_path = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'train'</span>, img_name)</div><div class="line">  <span class="selector-tag">img</span> = imread(image_path, flatten=True)</div><div class="line">  <span class="selector-tag">img</span> = <span class="selector-tag">img</span>.astype(<span class="string">'float32'</span>)</div><div class="line">  temp.append(img)</div><div class="line"></div><div class="line">train_x = np.stack(temp)</div><div class="line"></div><div class="line">train_x /= <span class="number">255.0</span></div><div class="line">train_x = train_x.reshape(-<span class="number">1</span>, <span class="number">784</span>).astype(<span class="string">'float32'</span>)</div><div class="line"></div><div class="line">temp = []</div><div class="line"><span class="keyword">for</span> img_name <span class="keyword">in</span> test<span class="selector-class">.filename</span>:</div><div class="line">  image_path = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(data_dir, <span class="string">'Train'</span>, <span class="string">'Images'</span>, <span class="string">'test'</span>, img_name)</div><div class="line">  <span class="selector-tag">img</span> = imread(image_path, flatten=True)</div><div class="line">  <span class="selector-tag">img</span> = <span class="selector-tag">img</span>.astype(<span class="string">'float32'</span>)</div><div class="line">  temp.append(img)</div><div class="line"></div><div class="line">test_x = np.stack(temp)</div><div class="line"></div><div class="line">test_x /= <span class="number">255.0</span></div><div class="line">test_x = test_x.reshape(-<span class="number">1</span>, <span class="number">784</span>).astype(<span class="string">'float32'</span>)</div><div class="line"></div><div class="line">train_y = keras<span class="selector-class">.utils</span><span class="selector-class">.np_utils</span><span class="selector-class">.to_categorical</span>(train<span class="selector-class">.label</span><span class="selector-class">.values</span>)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Divide our train data into training and validation</li>
                  </ul>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">split_size = int(train_x.shape<span class="string">[0]</span>*<span class="number">0</span>.<span class="number">7</span>)</div><div class="line"></div><div class="line">train_x, val_x = train_x<span class="string">[:split_size]</span>, train_x<span class="string">[split_size:]</span></div><div class="line">train_y, val_y = train_y<span class="string">[:split_size]</span>, train_y<span class="string">[split_size:]</span></div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Let’s start our tweaking! Lets change our model to be “wide”, i.e. increase the number of neurons in our hidden layer</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"><span class="attr">epochs</span> = <span class="number">5</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> Dense(<span class="attr">output_dim=hidden_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"></div><div class="line"> Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line">])</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Let’s test this model</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_500</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/trained_500.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/trained_500-1024x210.png" alt="trained_500"></a></p>
                  <ul>
                    <li>We see that this model performs significantly better than before! Now instead of “wide”, we try making our model “deep”. We add four more hidden layers with 50 neurons each</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden1_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden2_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden3_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden4_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden5_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">5</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> Dense(<span class="attr">output_dim=hidden1_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dense(<span class="attr">output_dim=hidden2_num_units,</span> <span class="attr">input_dim=hidden1_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dense(<span class="attr">output_dim=hidden3_num_units,</span> <span class="attr">input_dim=hidden2_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dense(<span class="attr">output_dim=hidden4_num_units,</span> <span class="attr">input_dim=hidden3_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dense(<span class="attr">output_dim=hidden5_num_units,</span> <span class="attr">input_dim=hidden4_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"></div><div class="line">Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden5_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line"> ])</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Any guesses on how this model would perform?</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_5d</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d-1024x215.png" alt="train_5d"></a></p>
                  <ul>
                    <li>Looks like we didn’t get what we expected. This may be because our model may be overfitting. To deal with this, we use a method called dropout. Dropout is essentially randomly turning off parts of the model so that it does not “overlearn”
                      a concept (To read more about dropout, check out the <a href="https://www.analyticsvidhya.com/blog/2016/08/evolution-core-concepts-deep-learning-neural-networks/" target="_blank" rel="external">article on core concepts of neural networks</a>)</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden1_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden2_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden3_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden4_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden5_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">5</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="attr">dropout_ratio</span> = <span class="number">0.2</span></div><div class="line"></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> Dense(<span class="attr">output_dim=hidden1_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(dropout_ratio),</div><div class="line"> Dense(<span class="attr">output_dim=hidden2_num_units,</span> <span class="attr">input_dim=hidden1_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(dropout_ratio),</div><div class="line"> Dense(<span class="attr">output_dim=hidden3_num_units,</span> <span class="attr">input_dim=hidden2_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(dropout_ratio),</div><div class="line"> Dense(<span class="attr">output_dim=hidden4_num_units,</span> <span class="attr">input_dim=hidden3_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(dropout_ratio),</div><div class="line"> Dense(<span class="attr">output_dim=hidden5_num_units,</span> <span class="attr">input_dim=hidden4_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(dropout_ratio),</div><div class="line"></div><div class="line">Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden5_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line"> ])</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Now let’s check our accuracy</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_5d_with_drop</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d_with_drop.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_5d_with_drop-1024x211.png" alt="train_5d_with_drop"></a></p>
                  <ul>
                    <li>Something seems off. It seems that our model is not performing well enough. One reason may be because we are not training our model to its full potential. Increase our training epochs to 50 and check it out!</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden1_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden2_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden3_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden4_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">hidden5_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">50</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> Dense(<span class="attr">output_dim=hidden1_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden2_num_units,</span> <span class="attr">input_dim=hidden1_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden3_num_units,</span> <span class="attr">input_dim=hidden2_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden4_num_units,</span> <span class="attr">input_dim=hidden3_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden5_num_units,</span> <span class="attr">input_dim=hidden4_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"></div><div class="line">Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden5_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line">])</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Well I’m excited to see what will happen. Are you?</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_5d_with_drop_more_epochs</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_drop_with_more_epoch.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_drop_with_more_epoch-1024x349.png" alt="train_drop_with_more_epoch"></a></p>
                  <ul>
                    <li>Yes! this is good. We see an increase in accuracy. (As an optional assignment, you could try increasing number of epochs to train more) Let’s try another thing, we make our model both deep and wide! We also implement all the tweaks
                      that we learnt before. For the purpose of getting faster results, we reduce the training epochs. But you are free to increase them if you want.</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_num_units</span> = <span class="number">784</span></div><div class="line"><span class="attr">hidden1_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">hidden2_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">hidden3_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">hidden4_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">hidden5_num_units</span> = <span class="number">500</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">25</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> Dense(<span class="attr">output_dim=hidden1_num_units,</span> <span class="attr">input_dim=input_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden2_num_units,</span> <span class="attr">input_dim=hidden1_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden3_num_units,</span> <span class="attr">input_dim=hidden2_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden4_num_units,</span> <span class="attr">input_dim=hidden3_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"> Dense(<span class="attr">output_dim=hidden5_num_units,</span> <span class="attr">input_dim=hidden4_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"> Dropout(<span class="number">0.2</span>),</div><div class="line"></div><div class="line">Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden5_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line"> ])</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>Forgive me for the spoliers, but its clear that our model would be better than all our models before.<a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme2.jpg" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/dl_meme2.jpg" alt="dl_meme2"></a>Still
                      lets check it out</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_deep_n_wide</span> = model.fit(train_x, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_model_deep_n_wide.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_model_deep_n_wide-1024x309.png" alt="train_model_deep_n_wide"></a></p>
                  <ul>
                    <li>Seems like we broke all the records! Lets submit this model to the solution checker</li>
                  </ul>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="built_in">pred</span> = model.predict_classes(test_x)</div><div class="line"> sample_submission.filename = test.filename; sample_submission.<span class="built_in">label</span> = <span class="built_in">pred</span></div><div class="line"> sample_submission.to_csv(os.path.<span class="built_in">join</span>(sub_dir, 'sub03.csv'), index=False)</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>As a last tweak, we will try changing the type of our model. Until now we made multilayer perceptrons (MLP). Let’s now change it to a convolutional neural network. (To get an in-depth introduction to convolutional neural network (CNN),
                      go through
                      <a href="https://www.analyticsvidhya.com/blog/2016/04/deep-learning-computer-vision-introduction-convolution-neural-networks/" target="_blank" rel="external">this article</a>). One thing necessary for running a CNN is that it requires
                      to be arranged in a specific format. So let’s reshape our data and feed it to our CNN.</li>
                  </ul>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre>
                        </td>
                        <td class="code">
                          <pre><div class="line"><span class="comment"># reshape data</span></div><div class="line"></div><div class="line"><span class="attr">train_x_temp</span> = train_x.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</div><div class="line"><span class="attr">val_x_temp</span> = val_x.reshape(-<span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># define vars</span></div><div class="line"><span class="attr">input_shape</span> = (<span class="number">784</span>,)</div><div class="line"><span class="attr">input_reshape</span> = (<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="attr">conv_num_filters</span> = <span class="number">5</span></div><div class="line"><span class="attr">conv_filter_size</span> = <span class="number">5</span></div><div class="line"></div><div class="line"><span class="attr">pool_size</span> = (<span class="number">2</span>, <span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="attr">hidden_num_units</span> = <span class="number">50</span></div><div class="line"><span class="attr">output_num_units</span> = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="attr">epochs</span> = <span class="number">5</span></div><div class="line"><span class="attr">batch_size</span> = <span class="number">128</span></div><div class="line"></div><div class="line"><span class="attr">model</span> = Sequential([</div><div class="line"> InputLayer(<span class="attr">input_shape=input_reshape),</span></div><div class="line"></div><div class="line"> Convolution2D(<span class="number">25</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="attr">activation='relu'),</span></div><div class="line"> MaxPooling2D(<span class="attr">pool_size=pool_size),</span></div><div class="line"></div><div class="line"> Convolution2D(<span class="number">25</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="attr">activation='relu'),</span></div><div class="line"> MaxPooling2D(<span class="attr">pool_size=pool_size),</span></div><div class="line"></div><div class="line"> Convolution2D(<span class="number">25</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="attr">activation='relu'),</span></div><div class="line"></div><div class="line"> Flatten(),</div><div class="line"></div><div class="line"> Dense(<span class="attr">output_dim=hidden_num_units,</span> <span class="attr">activation='relu'),</span></div><div class="line"></div><div class="line"> Dense(<span class="attr">output_dim=output_num_units,</span> <span class="attr">input_dim=hidden_num_units,</span> <span class="attr">activation='softmax'),</span></div><div class="line">])</div><div class="line"></div><div class="line">model.compile(<span class="attr">loss='categorical_crossentropy',</span> <span class="attr">optimizer='adam',</span> <span class="attr">metrics=['accuracy'])</span></div><div class="line"></div><div class="line"><span class="attr">trained_model_conv</span> = model.fit(train_x_temp, train_y, <span class="attr">nb_epoch=epochs,</span> <span class="attr">batch_size=batch_size,</span> <span class="attr">validation_data=(val_x_temp,</span> val_y))</div></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_cnn.png" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/train_cnn-1024x208.png" alt="train_cnn"></a></p>
                  <p>This result blows your mind, doesn’t it. Even with such small training time, the performance is way better! This proves that a better architecture can certainly boost your performance when dealing with neural networks.</p>
                  <p>It’s time to let go of the training wheels. There’s many things you can try, so many tweaks to do. Try this on your end and let us know how it goes!</p>
                  <h2 id="8-Where-to-go-from-here"><a href="#8-Where-to-go-from-here" class="headerlink" title="8. Where to go from here?"></a>8. Where to go from here?</h2>
                  <p>Now, you have a basic overview of Keras and a hands-on experience of implementing neural networks. There is still much more you can do. For example, I really like the implementation of <a href="https://github.com/awentzonline/image-analogies"
                      target="_blank" rel="external">keras to build image analogies</a>. In this project, the authors train a neural network to understand an image, and recreate learnt attributes to another image. As seen below, the first two images are
                    given as input, where the model trains on the first image and on giving input as second image, gives output as the third image.</p>
                  <p><a href="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/season-xfer.jpg" target="_blank" rel="external"><img src="https://www.analyticsvidhya.com/wp-content/uploads/2016/10/season-xfer-1024x234.jpg" alt="season-xfer"></a></p>
                  <p>Neural network tuning is still considered as a “dark art”. So, don’t expect that you would get the best model in your first try. Build, evaluate and reiterate, this is how you would be a better neural network practitioner.</p>
                  <p>Another point you should know that there are other methods to ensure that you would get a “good enough” neural network model without training it from scratch. Techniques like pre-training and transfer learning, are essential to know
                    when you are implementing neural network models to solve real life problems.</p>
                  <h2 id="9-Additional-Resources"><a href="#9-Additional-Resources" class="headerlink" title="9. Additional Resources"></a>9. Additional Resources</h2>
                  <ul>
                    <li><a href="https://keras.io/" target="_blank" rel="external">Keras official repository</a></li>
                    <li><a href="https://github.com/fchollet/keras-resources" target="_blank" rel="external">A curated list of keras resources</a></li>
                    <li><a href="https://groups.google.com/forum/#!forum/keras-users" target="_blank" rel="external">Keras User Group </a></li>
                  </ul>
                  <h2 id="End-Notes"><a href="#End-Notes" class="headerlink" title="End Notes"></a>End Notes</h2>
                  <p>I hope you found this article helpful. Now, it’s time for you to practice and read as much as you can. Good luck! If you have any recommendations / suggestions on neural networks, I’d love to interact with you in comments. If you have
                    any more doubts or queries feel to drop in your comments below. Try out the practice problem <a href="https://datahack.analyticsvidhya.com/contest/practice-problem-identify-the-digits/" target="_blank" rel="external">Identify the Digits</a>                    yourself and let me know what was your experience.</p>
                  <h3 id="You-can-test-your-skills-and-knowledge-Check-out-Live-Competitions-and-compete-with-best-Data-Scientists-from-all-over-the-world"><a href="#You-can-test-your-skills-and-knowledge-Check-out-Live-Competitions-and-compete-with-best-Data-Scientists-from-all-over-the-world" class="headerlink" title="You can test your skills and knowledge. Check out Live Competitions and compete with best Data Scientists from all over the world."></a>You
                    can test your skills and knowledge. Check out <a href="http://datahack.analyticsvidhya.com/contest/all" target="_blank" rel="external">Live Competitions</a> and compete with best Data Scientists from all over the world.</h3>
                  <p>原文链接：<a href="https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/" target="_blank" rel="external">https://www.analyticsvidhya.com/blog/2016/10/tutorial-optimizing-neural-networks-using-keras-with-image-recognition-case-study/</a></p>
                  <p>翻译：<a href="https://fenglv.ac.cn" target="_blank" rel="external">Flynn</a></p>
                  <p>
                    <div id="container"></div>
                  </p>
                  <p>
                    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
                  </p>
                  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
                  <script>
                    var gitment = new Gitment({
                      owner: 'ucasFL',
                      repo: 'BlogComments',
                      oauth: {

                        client_id: 'ef399b43f01e072241fd',
                        client_secret: '9258aef304e43fda24e51941bb0bbfc167e4e0a5',
                      },
                    })
                    gitment.render('container');
                  </script>

                </div>

                <div>




                </div>

                <div>




                </div>


                <footer class="post-footer">

                  <div class="post-tags">

                    <a href="/tags/Keras-translation/" rel="tag"># Keras translation</a>

                  </div>







                  <div class="post-nav">
                    <div class="post-nav-next post-nav-item">

                      <a href="/2017/11/12/an-introduction-to-implementing-neural-networks-using-tensorflow/" rel="next" title="使用 Tensorflow 实现神经网络">
                <i class="fa fa-chevron-left"></i> 使用 Tensorflow 实现神经网络
              </a>

                    </div>

                    <span class="post-nav-divider"></span>

                    <div class="post-nav-prev post-nav-item">

                    </div>
                  </div>




                </footer>
              </article>






              <div class="post-spread">


                <div class="bdsharebuttonbox">
                  <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
                  <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
                  <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
                  <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
                  <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
                  <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
                  <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
                  <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
                  <a href="#" class="bds_more" data-cmd="more"></a>
                  <a class="bds_count" data-cmd="count"></a>
                </div>
                <script>
                  window._bd_share_config = {
                    "common": {
                      "bdText": "",
                      "bdMini": "2",
                      "bdMiniList": false,
                      "bdPic": ""
                    },
                    "share": {
                      "bdSize": "16",
                      "bdStyle": "0"
                    },
                    "image": {
                      "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
                      "viewText": "分享到：",
                      "viewSize": "16"
                    }
                  }
                </script>

                <script>
                  with(document) 0[(getElementsByTagName('head')[0] || body).appendChild(createElement('script')).src = '//bdimg.share.baidu.com/static/api/js/share.js?cdnversion=' + ~(-new Date() / 36e5)];
                </script>


              </div>
            </div>


          </div>




          <div class="comments" id="comments">

          </div>


        </div>




        <div class="sidebar-toggle">
          <div class="sidebar-toggle-line-wrap">
            <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
            <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
            <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
          </div>
        </div>

        <aside id="sidebar" class="sidebar">
          <div class="sidebar-inner">




            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
                文章目录
              </li>
              <li class="sidebar-nav-overview" data-target="site-overview">
                站点概览
              </li>
            </ul>


            <section class="site-overview sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" src="/photos/profile.jpeg" alt="Flynn" />
                <p class="site-author-name" itemprop="name">Flynn</p>

                <p class="site-description motion-element" itemprop="description">高山仰止，景行行止</p>

              </div>
              <nav class="site-state motion-element">


                <div class="site-state-item site-state-posts">
                  <a href="/archives">
                <span class="site-state-item-count">89</span>
                <span class="site-state-item-name">日志</span>
              </a>
                </div>



                <div class="site-state-item site-state-categories">
                  <a href="/categories">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
                </div>



                <div class="site-state-item site-state-tags">
                  <a href="/tags">
                <span class="site-state-item-count">53</span>
                <span class="site-state-item-name">标签</span>
              </a>
                </div>


              </nav>


              <div class="feed-link motion-element">
                <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
              </div>


              <div class="links-of-author motion-element">


                <span class="links-of-author-item">
                <a href="https://github.com/ucasFL" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>

                <span class="links-of-author-item">
                <a href="http://weibo.com/fenglv1997" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>


              </div>



              <div class="cc-license motion-element" itemprop="license">
                <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
              </div>




              <div class="links-of-blogroll motion-element links-of-blogroll-inline">
                <div class="links-of-blogroll-title">
                  <i class="fa  fa-fw fa-globe"></i> 友情链接
                </div>
                <ul class="links-of-blogroll-list">

                  <li class="links-of-blogroll-item">
                    <a href="https://linux.cn/lctt/ucasfl" title="LCTT" target="_blank">LCTT</a>
                  </li>

                  <li class="links-of-blogroll-item">
                    <a href="https://ilovezyq.win" title="Miss.Zhu" target="_blank">Miss.Zhu</a>
                  </li>

                  <li class="links-of-blogroll-item">
                    <a href="https://www.moumaobuchiyu.com/" title="某猫" target="_blank">某猫</a>
                  </li>

                  <li class="links-of-blogroll-item">
                    <a href="https://shyboys.github.io/" title="shyboys" target="_blank">shyboys</a>
                  </li>

                </ul>
              </div>





            </section>


            <!--noindex-->
            <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
              <div class="post-toc">






                <div class="post-toc-content">
                  <ol class="nav">
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#Table-of-Contents"><span class="nav-number">2.</span> <span class="nav-text">Table of Contents</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#1-Keras-Overview"><span class="nav-number">3.</span> <span class="nav-text">1. Keras : Overview</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#2-Keras-Advantages"><span class="nav-number">4.</span> <span class="nav-text">2. Keras : Advantages</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#3-Keras-Limitations"><span class="nav-number">5.</span> <span class="nav-text">3. Keras : Limitations</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#4-General-way-to-solve-problems-with-Neural-Networks"><span class="nav-number">6.</span> <span class="nav-text">4. General way to solve problems with Neural Networks</span></a></li>
                    <li class="nav-item nav-level-2"><a class="nav-link" href="#5-Starting-with-a-simple-Keras-implementation-on-“Identify-the-Digits”"><span class="nav-number">7.</span> <span class="nav-text">5. Starting with a simple Keras implementation on “Identify the Digits”</span></a>
                      <ol
                        class="nav-child">
                        <li class="nav-item nav-level-3"><a class="nav-link" href="#STEP-0-Getting-Ready"><span class="nav-number">7.1.</span> <span class="nav-text">STEP 0: Getting Ready</span></a></li>
                        <li class="nav-item nav-level-3"><a class="nav-link" href="#STEP-1-Data-Loading-and-Preprocessing"><span class="nav-number">7.2.</span> <span class="nav-text">STEP 1: Data Loading and Preprocessing</span></a></li>
                        <li class="nav-item nav-level-3"><a class="nav-link" href="#STEP-2-Model-Building"><span class="nav-number">7.3.</span> <span class="nav-text">STEP 2: Model Building</span></a></li>
                        <li class="nav-item nav-level-3"><a class="nav-link" href="#STEP-3-Model-Evaluation"><span class="nav-number">7.4.</span> <span class="nav-text">STEP 3: Model Evaluation</span></a></li>
                  </ol>
                  </li>
                  <li class="nav-item nav-level-2"><a class="nav-link" href="#6-Hyperparameters-to-look-out-for-in-Neural-Networks"><span class="nav-number">8.</span> <span class="nav-text">6. Hyperparameters to look out for in Neural Networks</span></a></li>
                  <li class="nav-item nav-level-2"><a class="nav-link" href="#7-Getting-your-hands-dirty"><span class="nav-number">9.</span> <span class="nav-text">7. Getting your hands dirty</span></a></li>
                  <li class="nav-item nav-level-2"><a class="nav-link" href="#8-Where-to-go-from-here"><span class="nav-number">10.</span> <span class="nav-text">8. Where to go from here?</span></a></li>
                  <li class="nav-item nav-level-2"><a class="nav-link" href="#9-Additional-Resources"><span class="nav-number">11.</span> <span class="nav-text">9. Additional Resources</span></a></li>
                  <li class="nav-item nav-level-2"><a class="nav-link" href="#End-Notes"><span class="nav-number">12.</span> <span class="nav-text">End Notes</span></a>
                    <ol class="nav-child">
                      <li class="nav-item nav-level-3"><a class="nav-link" href="#You-can-test-your-skills-and-knowledge-Check-out-Live-Competitions-and-compete-with-best-Data-Scientists-from-all-over-the-world"><span class="nav-number">12.1.</span> <span class="nav-text">You
  can test your skills and knowledge. Check out Live Competitions and compete with best Data Scientists from all over the world.</span></a></li>
                    </ol>
                  </li>
                  </ol>
                </div>


              </div>
            </section>
            <!--/noindex-->




          </div>
        </aside>
        <script type="text/javascript" src="/js/src/op.js"></script>



      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">

          &copy; 2016 -
          <span itemprop="copyrightYear">2017</span>
          <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
          <span> <span><a href="https://fenglv.ac.cn">Flynn</a></span>
          </span>
        </div>



        <div>
          本站总点击 <span id="busuanzi_value_site_pv"></span> 次 &nbsp;&nbsp;|&nbsp;&nbsp;您是第 <span id="busuanzi_value_site_uv"></span> 位访客
        </div>


        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
        </script>


        <script>
          (function() {
            var bp = document.createElement('script');
            bp.src = '//push.zhanzhang.baidu.com/push.js';
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
          })();
        </script>







      </div>
    </footer>


    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>

      <span id="scrollpercent"><span>0</span>%</span>

    </div>


  </div>



  <script type="text/javascript">
    if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
      window.Promise = null;
    }
  </script>

















  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>


  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>


  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>


  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>


  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>





  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>







  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>




  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
  <script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>






  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>




































  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="local-search-pop-overlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function(xmlResponse) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $("entry", xmlResponse).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function() {
            var matchcounts = 0;
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if (data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if (index_title >= 0 || index_content >= 0) {
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g, "");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if (start < 0) {
                      start = 0;
                    }
                    if (start == 0) {
                      end = 50;
                    }
                    if (end > content.length) {
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword) {
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">" + keyword + "</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content + "...</p>"
                  }
                  str += "</li>";
                }
              })
            };
            str += "</ul>";
            if (matchcounts == 0) {
              str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            }
            if (keywords == "") {
              str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e) {
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e) {
      e.stopPropagation();
    });
  </script>




  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true, skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] } });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() { var all = MathJax.Hub.getAllJax(), i; for (i=0; i
    < all.length; i +=1 ) { all[i].SourceElement().parentNode.className +=' has-jax' ; } }); </script>
      <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>






      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
      <script>
        AV.initialize("uVJKiFx2eApAI7xacT3gsCi1-gzGzoHsz", "SFTRMIk7UoEgkKa1yn1C0b8q");
      </script>
      <script>
        function showTime(Counter) {
          var query = new AV.Query(Counter);
          var entries = [];
          var $visitors = $(".leancloud_visitors");

          $visitors.each(function() {
            entries.push($(this).attr("id").trim());
          });

          query.containedIn('url', entries);
          query.find()
            .done(function(results) {
              var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

              if (results.length === 0) {
                $visitors.find(COUNT_CONTAINER_REF).text(0);
                return;
              }

              for (var i = 0; i < results.length; i++) {
                var item = results[i];
                var url = item.get('url');
                var time = item.get('time');
                var element = document.getElementById(url);

                $(element).find(COUNT_CONTAINER_REF).text(time);
              }
              for (var i = 0; i < entries.length; i++) {
                var url = entries[i];
                var element = document.getElementById(url);
                var countSpan = $(element).find(COUNT_CONTAINER_REF);
                if (countSpan.text() == '') {
                  countSpan.text(0);
                }
              }
            })
            .fail(function(object, error) {
              console.log("Error: " + error.code + " " + error.message);
            });
        }

        function addCount(Counter) {
          var $visitors = $(".leancloud_visitors");
          var url = $visitors.attr('id').trim();
          var title = $visitors.attr('data-flag-title').trim();
          var query = new AV.Query(Counter);

          query.equalTo("url", url);
          query.find({
            success: function(results) {
              if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment("time");
                counter.save(null, {
                  success: function(counter) {
                    var $element = $(document.getElementById(url));
                    $element.find('.leancloud-visitors-count').text(counter.get('time'));
                  },
                  error: function(counter, error) {
                    console.log('Failed to save Visitor num, with error message: ' + error.message);
                  }
                });
              } else {
                var newcounter = new Counter();
                /* Set ACL */
                var acl = new AV.ACL();
                acl.setPublicReadAccess(true);
                acl.setPublicWriteAccess(true);
                newcounter.setACL(acl);
                /* End Set ACL */
                newcounter.set("title", title);
                newcounter.set("url", url);
                newcounter.set("time", 1);
                newcounter.save(null, {
                  success: function(newcounter) {
                    var $element = $(document.getElementById(url));
                    $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                  },
                  error: function(newcounter, error) {
                    console.log('Failed to create');
                  }
                });
              }
            },
            error: function(error) {
              console.log('Error:' + error.code + " " + error.message);
            }
          });
        }

        $(function() {
          var Counter = AV.Object.extend("Counter");
          if ($('.leancloud_visitors').length == 1) {
            addCount(Counter);
          } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
          }
        });
      </script>




      <script>
        (function() {
          var bp = document.createElement('script');
          var curProtocol = window.location.protocol.split(':')[0];
          if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
          } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
          }
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(bp, s);
        })();
      </script>







</body>

</html>
<!-- 动态背景 -->

<script type="text/javascript" src="/js/src/particle.js"></script>

<script type="text/javascript" src="/js/src/particle.js" count="50" zindex="-2" opacity="1" color="0,104,183"></script>

<!-- 小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>